"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireWildcard(require("react")),_utils=require("../utils"),_propTypes=_interopRequireDefault(require("prop-types")),_field=_interopRequireDefault(require("./field"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}return b.default=a,b}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var UserForm=/*#__PURE__*/function(a){function b(){var a,c;_classCallCheck(this,b);for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=_possibleConstructorReturn(this,(a=_getPrototypeOf(b)).call.apply(a,[this].concat(e))),_defineProperty(_assertThisInitialized(c),"state",{id:"",addressList:["City","Postalcode","Phone"],form:{copyAddress:!1},error:{},validated:{},mandatory:{},validationTypes:{}}),_defineProperty(_assertThisInitialized(c),"handleValidateUnitaryInput",function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{value:c.state.form[a]},d=c.state,e=c.state.validationTypes;return d.validated[a]=!1,0<e[a].length?e[a].forEach(function(e){var f=e.method,g=e.withwho;e.withValue="comparison"===f?c.state.form[g]:"",d.validated[a]=d.validated[a]||(0,_utils.validateType)(e,b)}):d.validated[a]=!0,d}),_defineProperty(_assertThisInitialized(c),"handleValidateInputs",function(){var a=c.state;if(c.props.formEdit)for(var b in a.form=c.props.formEdit,a.form)a=c.handleValidateUnitaryInput(b,{value:a.form[b]});c.setState(a)}),_defineProperty(_assertThisInitialized(c),"handleGenericChange",function(a){var b=a.value,d=a.name,e=c.state.form;e=_objectSpread({},e,_defineProperty({},d,b));var f=_objectSpread({},c.state.error,_defineProperty({},d,!1)),g=_objectSpread({},c.state.validated,_defineProperty({},d,!0));c.setState({form:e,error:f,validated:g})}),_defineProperty(_assertThisInitialized(c),"handleCheckboxChange",function(a){var b=a.checked,d=a.name,e=c.state.form;e=_objectSpread({},e,_defineProperty({},d,b));var f=_objectSpread({},c.state.error,_defineProperty({},d,!1)),g=_objectSpread({},c.state.validated,_defineProperty({},d,!0));c.setState({form:e,error:f,validated:g})}),_defineProperty(_assertThisInitialized(c),"handleRadioChange",function(a){var b=a.name,d=a.id,e=c.state.form;e=_objectSpread({},e,_defineProperty({},b,d));var f=_objectSpread({},c.state.error,_defineProperty({},b,!1)),g=_objectSpread({},c.state.validated,_defineProperty({},b,!0));c.setState({form:e,error:f,validated:g})}),_defineProperty(_assertThisInitialized(c),"handleChange",function(a,b){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a.target,e=d.name,f=d.value,g=d.checked,h=d.id;"checkbox-copy"===b?c.handleCopyChange(g,e):"checkbox"===b?c.handleCheckboxChange({checked:g,name:e}):"radio"===b?c.handleRadioChange({name:e,id:h}):c.handleGenericChange({value:f,name:e})}),_defineProperty(_assertThisInitialized(c),"handleValidate",function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.target,d=b.name,e=c.handleValidateUnitaryInput(d).validated[d];c.setState({validated:_objectSpread({},c.state.validated,_defineProperty({},a.target.id,e))})}),_defineProperty(_assertThisInitialized(c),"handleSubmit",function(a){a.preventDefault();var b=c.state.error,d=!0;try{for(var e in c.state.form)c.handleValidateUnitaryInput(e),b[e]=!c.state.validated[e]||!(0,_utils.validateType)({method:"mandatory"},{value:c.state.form[e],mandatory:c.state.mandatory[e]}),d=d&&!b[e]}catch(a){console.log("Error trying to submit data ",a)}c.setState({error:b},function(){d&&c.props.submit(c.state.form)})}),_defineProperty(_assertThisInitialized(c),"handleCopyChange",function(a,b){var d=c.state.form;c.props.formStructure.filter(function(a){return a.copyOf}).forEach(function(b){d[b.id]=a?d[b.copyOf]:""});var e=_objectSpread({},c.state.error,_defineProperty({},b,!1)),f=_objectSpread({},c.state.validated,_defineProperty({},b,!0));c.setState({form:d,error:e,validated:f})}),c}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function componentDidMount(){this.handleValidateInputs()}},{key:"render",value:function render(){var a=this,b=this.props,c=b.formStructure,d=void 0===c?[]:c,e=b.Validation,f=b.SubmitButton,g=b.formTitle,h=b.autoComplete;return _react.default.createElement("form",{className:"c-userform",onSubmit:this.handleSubmit,autoComplete:h},_react.default.createElement("h3",null," ","".concat(g)," "),d.map(function(b){var c=b.name,d=b.id,f=b.type,g=b.options,h=b.placeholder,i=b.title,j=b.titlePosition,k=b.checked,l=b.tagText,m=b.tagName;return _react.default.createElement(_field.default,{key:d,id:d,checked:k,title:i,titlePosition:j,tagName:m,tagText:l,error:a.state.error[c],handleChange:a.handleChange,handleOnBlur:a.handleValidate,value:a.state.form[c],type:f,name:c,options:g,placeholder:h,validation:_react.default.createElement(e,{valid:a.state.validated[c]})})}),_react.default.createElement(f,{text:this.props.SubmitButtonText}))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(a,b){//we only setup state the first time depending on props data
if(a.id!==b.id){var c=a.formStructure,d=void 0===c?[]:c,e={mandatory:{},error:{},validated:{},validationTypes:{},form:{}};return d.forEach(function(a){var b=a.mandatory,c=a.name,d=a.validation;e.mandatory[c]=b,e.error[c]=!1,e.validated[c]=!0,e.validationTypes[c]=d,e.form[c]=""}),{mandatory:e.mandatory,error:e.error,validated:e.validated,validationTypes:e.validationTypes,form:e.form,id:a.id}}// No state update necessary
return null}}]),b}(_react.Component);_defineProperty(UserForm,"propTypes",{formStructure:_propTypes.default.arrayOf(_propTypes.default.shape({name:_propTypes.default.string.isRequired,id:_propTypes.default.string.isRequired,checked:_propTypes.default.bool,copyOf:_propTypes.default.string,title:_propTypes.default.string,titlePosition:_propTypes.default.number.isRequired,type:_propTypes.default.string.isRequired,mandatory:_propTypes.default.bool.isRequired,placeholder:_propTypes.default.string.isRequired,validation:_propTypes.default.arrayOf(_propTypes.default.shape({method:_propTypes.default.string,length:_propTypes.default.number,withwho:_propTypes.default.string,withValue:_propTypes.default.string})).isRequired})).isRequired,formEdit:_propTypes.default.object,formTitle:_propTypes.default.string,id:_propTypes.default.string.isRequired,submit:_propTypes.default.func.isRequired,Validation:_propTypes.default.func,SubmitButton:_propTypes.default.func,SubmitButtonText:_propTypes.default.string}),_defineProperty(UserForm,"defaultProps",{formStructure:[],formTitle:"",id:"register",SubmitButtonText:"enviar",submit:function submit(){},SubmitButton:function SubmitButton(a){var b=a.text;return _react.default.createElement("button",{type:"submit",variant:"contained",className:"c-button"},b)},Validation:function Validation(a){var b=a.valid;return _react.default.createElement("div",{className:"input--".concat(b?"valid":"invalid")},"validated: ".concat(b))}});var _default=UserForm;exports.default=_default,module.exports=exports.default;